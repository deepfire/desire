<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
lang="en" xml:lang="en">
<head>

<title>Overview of desire, a software knowledge and distribution system.</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2009-10-10 01:33:20 MSD"/>
<meta name="author" content="Samium Gromoff"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Overview of desire, a software knowledge and distribution system.</h1>

<p>October 10, 2009, 01:30
</p>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 About this document </a></li>
<li><a href="#sec-2">2 What is desire (supposed to be)? </a></li>
<li><a href="#sec-3">3 How to obtain desire? </a></li>
<li><a href="#sec-4">4 Overview of terms </a>
<ul>
<li><a href="#sec-4.1">4.1 Distributors </a></li>
<li><a href="#sec-4.2">4.2 Remotes </a></li>
<li><a href="#sec-4.3">4.3 Modules </a></li>
<li><a href="#sec-4.4">4.4 Systems </a></li>
<li><a href="#sec-4.5">4.5 Applications </a></li>
<li><a href="#sec-4.6">4.6 Localities </a></li>
</ul>
</li>
<li><a href="#sec-5">5 API (aka end-user interface) </a>
<ul>
<li><a href="#sec-5.1">5.1 Querying the knowledge base: user level </a></li>
<li><a href="#sec-5.2">5.2 Making wishes </a>
<ul>
<li><a href="#sec-5.2.1">5.2.1 Reader macros for add-module </a></li>
</ul>
</li>
<li><a href="#sec-5.3">5.3 Querying the knowledge base: advanced level </a></li>
</ul>
</li>
<li><a href="#sec-6">6 Workflow </a>
<ul>
<li><a href="#sec-6.1">6.1 Streamlined bootstrap </a></li>
<li><a href="#sec-6.2">6.2 Advanced use </a>
<ul>
<li><a href="#sec-6.2.1">6.2.1 User mode </a></li>
<li><a href="#sec-6.2.2">6.2.2 Wishmaster mode </a></li>
<li><a href="#sec-6.2.3">6.2.3 Extending definitions </a></li>
<li><a href="#sec-6.2.4">6.2.4 The real truth about wishmaster and user modes </a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-7">7 Shortcomings </a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> About this document </h2>
<div class="outline-text-2" id="text-1">


<p>
This document has a canonical location:
</p>
<p>
<a href="http://www.feelingofgreen.ru/shared/git/desire/doc/overview.html">http://www.feelingofgreen.ru/shared/git/desire/doc/overview.html</a>
</p>
<p>
or, for the Org-mode source:
</p>
<p>
<a href="http://www.feelingofgreen.ru/shared/git/desire/doc/overview.org">http://www.feelingofgreen.ru/shared/git/desire/doc/overview.org</a>
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> What is desire (supposed to be)? </h2>
<div class="outline-text-2" id="text-2">


<p>
The domain of desire includes software distribution points, software
modules and applications. All these terms are represented internally
in a detailed, comprehensive manner, and full knowledge about them is
maintained in a PRINT/READ-able form, additionally being easily
transportable<sup><a class="footref" name="fnr.1" href="#fn.1">1</a></sup> between desire nodes.
</p>
<p>
There are two sides of desire<sup><a class="footref" name="fnr.2" href="#fn.2">2</a></sup>:
</p><ul>
<li>
 maximally streamlined software retrieval, and
</li>
<li>
 redistribution.

</li>
</ul>

<p>Desire shares concepts with and provides features like, at least:
</p><ul>
<li>
 asdf-install
</li>
<li>
 mudballs
</li>
<li>
 clbuild

</li>
</ul>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> How to obtain desire? </h2>
<div class="outline-text-2" id="text-3">


<p>
Desire can be obtained at:
</p>
<p>
git://git.feelingofgreen.ru/desire
</p>
<p>
but please see <a href="#sec-3">Streamlined bootstrap</a>.
</p>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Overview of terms </h2>
<div class="outline-text-2" id="text-4">


</div>

<div id="outline-container-4.1" class="outline-3">
<h3 id="sec-4.1"><span class="section-number-3">4.1</span> Distributors </h3>
<div class="outline-text-3" id="text-4.1">


<p>
The largest unit of software granularity is a 'distributor', which
corresponds to an internet domain name<sup><a class="footref" name="fnr.3" href="#fn.3">3</a></sup>. Currently, they don't carry
much information beyond just that.
</p>
<p>
'Wishmasters' represent instances of desire acting as distributors which
are in business of making ordinary desire users' lives easier by
repackaging modules from their respective VCS of choice into git,
thereby relieving burden from the user and reducing the amount of points
of failure.
</p>
</div>

</div>

<div id="outline-container-4.2" class="outline-3">
<h3 id="sec-4.2"><span class="section-number-3">4.2</span> Remotes </h3>
<div class="outline-text-3" id="text-4.2">


<p>
Distributors contain one or more 'remotes', which combine following
concepts:
</p><ul>
<li>
version control system type (git, darcs, cvs or svn)
</li>
<li>
transport type (native, http or rsync)
</li>
<li>
simple pattern path on the distributor
</li>
<li>
an internet port number

</li>
</ul>

<p>The concept of remote serves (or actually, the more general type of
location does) as a point of distribution for a group of modules.
</p>
</div>

</div>

<div id="outline-container-4.3" class="outline-3">
<h3 id="sec-4.3"><span class="section-number-3">4.3</span> Modules </h3>
<div class="outline-text-3" id="text-4.3">


<p>
Modules represent units of software, as released by the distributor,
and contain the information remaining to complete the information
provided by less granular concepts to construct a module address.
</p>
<p>
Modules can be provided by several different remotes of different
distributors.
</p>
</div>

</div>

<div id="outline-container-4.4" class="outline-3">
<h3 id="sec-4.4"><span class="section-number-3">4.4</span> Systems </h3>
<div class="outline-text-3" id="text-4.4">


<p>
Descending further down we meet systems.
Systems are objects only meant to be relevant in the domain of Common Lisp
software, and more precisely &ndash; to backend system definition facilities,
such as ASDF, XCVB, Mudballs or others<sup><a class="footref" name="fnr.4" href="#fn.4">4</a></sup>.
</p>
<p>
The concept of system introduces inter-system dependencies, which cross
module boundaries, producing inter-module dependencies.
</p>
<p>
Evidently, there can be several systems per module, and also those
can be obscured from the end-user, either intentionally or by unfortunate
accident<sup><a class="footref" name="fnr.5" href="#fn.5">5</a></sup>.
</p>
<p>
Desire handles all these complications and operates on the full
inter-module dependency graph. It also doesn't store that graph anywhere,
recomputing it instead every time a request for module is performed.
</p>
</div>

</div>

<div id="outline-container-4.5" class="outline-3">
<h3 id="sec-4.5"><span class="section-number-3">4.5</span> Applications </h3>
<div class="outline-text-3" id="text-4.5">


<p>
Applications are simple extensions of systems, providing some very
preliminary support for launching applications, potentially simplifiable
to the point of the end-user being able to say "launch mcclim" and
have everything downloaded, required systems loaded and the application
up and running as a result.
</p>
</div>

</div>

<div id="outline-container-4.6" class="outline-3">
<h3 id="sec-4.6"><span class="section-number-3">4.6</span> Localities </h3>
<div class="outline-text-3" id="text-4.6">


<p>
The more general type of 'location' besides remotes also includes
'localities', which serve the same purpose as remotes, but on the local
machine. Master localities are canonical locations for module repositories
managed by a specific VCS type.
The master git locality is a canonical location for module redistribution.
</p>
</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> API (aka end-user interface) </h2>
<div class="outline-text-2" id="text-5">


</div>

<div id="outline-container-5.1" class="outline-3">
<h3 id="sec-5.1"><span class="section-number-3">5.1</span> Querying the knowledge base: user level </h3>
<div class="outline-text-3" id="text-5.1">


<ul>
<li>
distributor name &amp;key (if-does-not-exist :error) =&gt; distributor
</li>
<li>
remote name &amp;key (if-does-not-exist :error) =&gt; remote
</li>
<li>
module name &amp;key (if-does-not-exist :error) =&gt; module
</li>
<li>
system name &amp;key (if-does-not-exist :error) =&gt; system
</li>
<li>
app name &amp;key (if-does-not-exist :error) =&gt; app
</li>
<li>
locality name &amp;key (if-does-not-exist :error) =&gt; locality
</li>
<li>
master name &amp;key (if-does-not-exist :error) =&gt; locality

</li>
<li>
name object =&gt; symbol

</li>
<li>
url remote-designator &amp;optional module-specifier =&gt; string

</li>
<li>
apropos-desr string-designator &amp;optional set-designator =&gt; &lt;no values&gt;
</li>
<li>
apropos-desr-list string-designator &amp;optional set-designator =&gt; desirables
</li>
<li>
list-modules =&gt; &lt;no values&gt;

</li>
<li>
module-present-p module-designator module &amp;optional (locality (master 'git)) check-when-present-p (check-when-missing-p t) =&gt; boolean
</li>
<li>
system-loadable-p system-designator &amp;optional (locality (master 'git)) =&gt; generalised-boolean

</li>
</ul>
</div>

</div>

<div id="outline-container-5.2" class="outline-3">
<h3 id="sec-5.2"><span class="section-number-3">5.2</span> Making wishes </h3>
<div class="outline-text-3" id="text-5.2">


<ul>
<li>
init path &amp;key as (default-wishmasters (list desr:*default-wishmaster*)) =&gt; boolean
</li>
<li>
lust &amp;rest module-names =&gt; boolean
</li>
<li>
add-module url &amp;optional module-name &amp;key systemlessp (system-type desr:*default-system-type*) (lust desr:*auto-lust*) =&gt; module

</li>
</ul>

</div>

<div id="outline-container-5.2.1" class="outline-4">
<h4 id="sec-5.2.1"><span class="section-number-4">5.2.1</span> Reader macros for add-module </h4>
<div class="outline-text-4" id="text-5.2.1">


<p>
Following reader macro is enabled by install-add-module-reader:
</p>

</div>
</div>

</div>

<div id="outline-container-5.3" class="outline-3">
<h3 id="sec-5.3"><span class="section-number-3">5.3</span> Querying the knowledge base: advanced level </h3>
<div class="outline-text-3" id="text-5.3">


<ul>
<li>
system-definition system repository-path &amp;key (if-does-not-exist :error) =&gt; pathname

</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Workflow </h2>
<div class="outline-text-2" id="text-6">


</div>

<div id="outline-container-6.1" class="outline-3">
<h3 id="sec-6.1"><span class="section-number-3">6.1</span> Streamlined bootstrap </h3>
<div class="outline-text-3" id="text-6.1">


<p>
To attain maximum ease, desire includes a booststrap script, whose
canonical permanent location is:
</p>
<p>
<a href="http://www.feelingofgreen.ru/shared/git/desire/climb.sh">http://www.feelingofgreen.ru/shared/git/desire/climb.sh</a>
</p>
<p>
The first argument should be an empty, writable filesystem location.
That is, the exact filename must not exist, but its parent must exist,
and be writable.
</p>
<p>
This location will be registered as root directory for per-VCS localities,
serving to satisfy storage needs arising from user module retrieval requests.
</p>
<p>
The path to the 'git/.asdf-registry/' subdirectory of this root directory
should be pushed into ASDF:*CENTRAL-REGISTRY*, if ASDF is to have access
to modules in the desire's pool.
</p>
<p>
This script when invoked performs following operations:
</p>
<ul>
<li>
 use git to download modules desire depends on, placing them in /tmp,
</li>
<li>
 load desire,
</li>
<li>
 the most important part, cheer up the user!

</li>
</ul>
</div>

</div>

<div id="outline-container-6.2" class="outline-3">
<h3 id="sec-6.2"><span class="section-number-3">6.2</span> Advanced use </h3>
<div class="outline-text-3" id="text-6.2">


<p>
Depending on the way you intend to run desire, you issue either:
</p>
<p>
(init "<i>path/to/root</i>"), for user mode
or:
(init "<i>path/to/root</i>" :as 'well-known-distributor), for wishmaster mode
</p>
<p>
(This path provided to INIT will henceforth be referred to as $ROOT.)
</p>
<p>
The modes provide the end-user with a tradeoff between hassle and variety
of module available.
</p>
<p>
This stems from the difference between operation of wishmaster and user modes.
</p>
<p>
Wishmasters use a variety of tools to access the whole set of modules retrievable
using desire, but from this power comes fragility and, because wishmasters also
serve the role of simplifier gateways, time consuming whatever-&gt;git repository
conversion process.
</p>
<p>
User mode is the chief reason for that complications, as the only thing the user
needs to have is git, and boy is that fast<sup><a class="footref" name="fnr.6" href="#fn.6">6</a></sup>.
</p>
<p>
The price, though, is relying on the set of modules available from wishmasters.
</p>

</div>

<div id="outline-container-6.2.1" class="outline-4">
<h4 id="sec-6.2.1"><span class="section-number-4">6.2.1</span> User mode </h4>
<div class="outline-text-4" id="text-6.2.1">


<p>
During INIT a default wishmaster (currently 'git.feelingofgreen.ru) will be
chosen, its module export set will be retrieved and that, with the notable
addition of modules present in $ROOT/git/, will constitute the whole set
available to the end user.
</p>
<p>
Who is, then, free to use LUST, APROPOS-DESR, LIST-MODULES and other
such functions listed in section 3.
</p>
</div>

</div>

<div id="outline-container-6.2.2" class="outline-4">
<h4 id="sec-6.2.2"><span class="section-number-4">6.2.2</span> Wishmaster mode </h4>
<div class="outline-text-4" id="text-6.2.2">


<p>
This mode requires that the $ROOT/git/.meta/DEFINITIONS file contains
a definition for the distributor your desire node will act as,
and whose name you will pass using the :AS keyword to the INIT function.
</p>
<p>
For the time being, it makes most sense to seed the definitions file
from what is already accumulated at feelingofgreen.ru:
</p>
<p>
<a href="http://www.feelingofgreen.ru/shared/git/.meta/DEFINITIONS">http://www.feelingofgreen.ru/shared/git/.meta/DEFINITIONS</a>
</p>
<p>
It contains a healthy set of definitions which should be enough for
beginning.
</p>
<p>
The INIT function:
</p>
<ul>
<li>
 scans for modules in the canonical export location $ROOT/git/
</li>
<li>
 checks that this set includes every module that is claimed to be
"well known" to be distributed by our distributor<sup><a class="footref" name="fnr.7" href="#fn.7">7</a></sup>, otherwise
signalling an error
</li>
<li>
 publishes the informations about non-"well known", converted modules
</li>
<li>
 calls it a day


</li>
<li id="sec-6.2.2.1">External executables required for module conversion <br/>

<p>
The conversion is performed by external programs:
</p>
<ul>
<li>
 darcs-to-git<sup><a class="footref" name="fnr.8" href="#fn.8">8</a></sup>
</li>
<li>
 git cvs, debian package git-cvs
</li>
<li>
 git svn, debian package git-svn

</li>
</ul>
</li>
</ul>
</div>

</div>

<div id="outline-container-6.2.3" class="outline-4">
<h4 id="sec-6.2.3"><span class="section-number-4">6.2.3</span> Extending definitions </h4>
<div class="outline-text-4" id="text-6.2.3">


<p>
ADD-MODULE and the accompanying reader macro #@"u://r.l/" is a one-stop
point useful for manual extension of the set of known entities. The URI
type of the URL must name to the VCS used at the given distribution point,
that is one of 'git', 'http' (which actually means git+http), 'darcs',
'cvs' or 'svn'.
</p>
<p>
The required super-entities are either found among current definitions,
or created on the spot.
</p>
<p>
SAVE-CURRENT-DEFINITIONS writes out changes into
$ROOT/git/.meta/DEFINITIONS
</p>
</div>

</div>

<div id="outline-container-6.2.4" class="outline-4">
<h4 id="sec-6.2.4"><span class="section-number-4">6.2.4</span> The real truth about wishmaster and user modes </h4>
<div class="outline-text-4" id="text-6.2.4">


<p>
The real truth is a bit more complicated, as the two modes have a
non-trivial intersection in the ways they work. A more complete, proper
explanation of underlying reasons for some of the choices is due.
Some of the obvious functionality, like using non-converted modules
without the pains of reexporting them, is clearly missing, but shouldn't
be too hard to implement.
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Shortcomings </h2>
<div class="outline-text-2" id="text-7">


<p>
Some problems which pop out off the top of the head:
</p>
<ul>
<li>
 SBCL-only
</li>
<li>
 ASDF-only
</li>
<li>
 Linux-only (might work on other unices)
</li>
<li>
 has a non-trivial amount of CL library dependencies, half of them
not exactly being common
</li>
<li>
 calls out to an obscene amount of external executables, thereby only
being able to guess about failure reasons
</li>
<li>
 can not do anything with software released as tarballs 
</li>
<li>
 is git-centric (probably not a big issue)
</li>
<li>
 obviously has rough edges

</li>
</ul>


<hr/>











</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn.1" href="#fnr.1">1</a></sup> Not yet, but the client mode depends on it, so at least partially it works.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.2" href="#fnr.2">2</a></sup> Although, by nature of being a full-knowledge system the applications might
easily go beyond that.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.3" href="#fnr.3">3</a></sup> Actually, sometimes a group of domain names, like in case of sourceforge.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.4" href="#fnr.4">4</a></sup> Currently, the only backend system implemented is ASDF.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.5" href="#fnr.5">5</a></sup> Recovering such hidden systems complicates construction of full dependency graph in case of ASDF.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.6" href="#fnr.6">6</a></sup> Not faster than downloading and extracting release tarballs, though.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.7" href="#fnr.7">7</a></sup> This is tied to the concept of well known release locations and differs
from the set of modules converted and reexported in the wishmaster
process.
</p>
<p class="footnote"><sup><a class="footnum" name="fn.8" href="#fnr.8">8</a></sup> Seemingly no longer available at original location, still can be obtained
through git://git.feelingofgreen.ru/darcs-to-git
</p>
</div>
</div>
<div id="postamble">
<p class="author"> Author: Samium Gromoff
<a href="mailto:_deepfire@feelingofgreen.ru">&lt;_deepfire@feelingofgreen.ru&gt;</a>
</p>
<p class="date"> Date: 2009-10-10 01:33:20 MSD</p>
<p class="creator">HTML generated by org-mode 6.31 in emacs 23</p>
</div>
</div>
</body>
</html>
